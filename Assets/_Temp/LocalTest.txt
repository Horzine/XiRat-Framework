[InitializeOnLoad]
public class DebugMode
{
    private static bool m_Inited;
    
    [PostProcessScene(1)]
    static void PrepareSceneForLocalTest()
    {
        EditorApplication.playModeStateChanged += HandleOnPlayModeChanged;
        if (DebugModeManager.isLocalTestMode && EditorApplication.isPlayingOrWillChangePlaymode)
        {
            if (m_Inited) return;

            m_Inited = true;
            
            if (GameObject.FindObjectOfType<CamTargetManager>() == null)
            {
                foreach (var cam in GameObject.FindObjectsOfType<Camera>())
                    cam.gameObject.SetActive(false);

                GameObject.Instantiate(AssetDatabase.LoadAssetAtPath("Assets/Recreate/Prefabs/Basics/CamHolder.prefab",
                    typeof(GameObject)) as GameObject);
            }

            GameObject commonManagerGo = new GameObject("Common");
            commonManagerGo.AddComponent<Recreate.Effect.GlobalShaderQualitySwitchController>();
            GameObject.Instantiate(AssetDatabase.LoadAssetAtPath("Assets/Recreate/Prefabs/Basics/DontDestroyOnLoadGo.prefab", typeof(GameObject)) as GameObject);
            GameObject.Instantiate(AssetDatabase.LoadAssetAtPath("Assets/Recreate/Prefabs/Basics/LocalTestCanvas.prefab", typeof(GameObject)) as GameObject);
        }
    }

    static void HandleOnPlayModeChanged(UnityEditor.PlayModeStateChange playMode)
    {
        if (playMode == PlayModeStateChange.ExitingPlayMode)
        {
            DebugModeManager.isLocalTestMode = false;
            m_Inited = false;
        }
    }
}
